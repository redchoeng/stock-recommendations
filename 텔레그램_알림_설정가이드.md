# 텔레그램 알림 설정 가이드

## 기능

📱 **자동 알림 시스템**
- ✅ **14일 리밸런싱 결과** 자동 전송
- 🚨 **시장 급변 감지** 즉시 알림
- 📊 **일일 시장 요약** 전송

---

## 1단계: 텔레그램 봇 생성

### 1-1. BotFather 찾기
1. 텔레그램 앱 실행
2. 검색창에 `@BotFather` 입력
3. 공식 BotFather 선택 (파란 체크 마크)

### 1-2. 봇 생성
1. `/start` 명령 전송
2. `/newbot` 명령 전송
3. 봇 이름 입력 (예: `My Stock Bot`)
4. 봇 사용자명 입력 (예: `my_stock_recommendation_bot`)
   - 반드시 `bot`으로 끝나야 함
   - 이미 사용 중인 이름이면 다른 이름 시도

### 1-3. 봇 토큰 받기
```
✅ 성공 메시지:
Done! Congratulations on your new bot.
...
Use this token to access the HTTP API:
123456789:ABCdefGHIjklMNOpqrsTUVwxyz
```

**봇 토큰을 복사하세요!** (예시 형식: `123456:ABC-DEF...`)

---

## 2단계: Chat ID 찾기

### 2-1. 봇과 대화 시작
1. BotFather가 준 링크 클릭 (예: `t.me/my_stock_recommendation_bot`)
2. 또는 텔레그램 검색에서 봇 찾기
3. **START** 버튼 클릭
4. 아무 메시지나 1개 전송 (예: `Hello`)

### 2-2. Chat ID 확인
1. 브라우저에서 다음 URL 접속:
   ```
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```

   **예시:**
   ```
   https://api.telegram.org/bot123456:ABC-DEF/getUpdates
   ```

2. 다음과 같은 JSON 응답에서 `chat` → `id` 찾기:
   ```json
   {
     "ok": true,
     "result": [{
       "message": {
         "chat": {
           "id": 987654321,  ← 이 숫자가 Chat ID
           "first_name": "Your Name"
         }
       }
     }]
   }
   ```

3. **Chat ID를 복사하세요!** (예: `987654321`)

---

## 3단계: config.py 설정

### 3-1. config.py 생성
```bash
# Windows
copy config.example.py config.py

# Mac/Linux
cp config.example.py config.py
```

### 3-2. config.py 편집
파일을 열고 다음 항목 수정:

```python
# 텔레그램 봇 토큰 (1단계에서 받은 토큰)
TELEGRAM_BOT_TOKEN = "123456789:ABCdefGHIjklMNOpqrsTUVwxyz"

# 텔레그램 채팅 ID (2단계에서 받은 ID)
TELEGRAM_CHAT_ID = "987654321"
```

### 3-3. 파일 저장
- 수정 후 저장 (Ctrl+S 또는 Cmd+S)

---

## 4단계: 테스트

### 4-1. 테스트 실행
```bash
python telegram_notifier.py
```

### 4-2. 확인
텔레그램에서 다음 메시지를 받으면 **성공**:

```
🎉 텔레그램 알림 설정 완료!

주식 추천 봇이 정상 작동합니다.

앞으로 다음 알림을 받게 됩니다:
✅ 14일 리밸런싱 결과
🚨 시장 급변 알림
📊 일일 시장 요약

🔗 보고서 바로가기
```

---

## 5단계: 자동 실행 설정

### 5-1. GitHub Actions 업데이트

`.github/workflows/daily-update.yml` 파일 수정:

```yaml
- name: Install dependencies
  run: |
    pip install yfinance pandas numpy requests textblob

- name: Daily update with Telegram
  env:
    TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
    TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
  run: |
    python daily_update_with_telegram.py
```

### 5-2. GitHub Secrets 설정

1. GitHub 저장소 페이지 접속
2. **Settings** → **Secrets and variables** → **Actions**
3. **New repository secret** 클릭
4. 2개 시크릿 추가:
   - Name: `TELEGRAM_BOT_TOKEN`
     - Value: `123456789:ABCdefGHI...` (봇 토큰)
   - Name: `TELEGRAM_CHAT_ID`
     - Value: `987654321` (채팅 ID)

---

## 알림 종류

### 1. 리밸런싱 알림 (14일마다)
```
🔄 리밸런싱 알림 (2026-02-03)

📊 추천 종목 TOP 10
1. AAPL (점수: 85.5)
   기술: 65.0/75, 뉴스: 18.5/20
2. MSFT (점수: 83.2)
   ...

📈 전략 성과
수익률: +3.43%
샤프 비율: 4.49
승률: 75.0%

🔗 상세 보고서 확인
```

### 2. 시장 급변 알림 (즉시)
```
🔴 급락 경고 (2026-02-03 14:30)

⚠️ 급락 + 고변동성
- 방어주 비중 확대 고려
- 현금 보유 비율 증가
- 리밸런싱 연기 권장

현재 상황:
S&P500: -3.50%
VIX: 32.5 (변동성)

권장 조치:
⚠️ 급락 + 고변동성
- 방어주 비중 확대 고려
...

🔗 실시간 분석 확인
```

### 3. 일일 시장 요약 (매일)
```
📊 일일 시장 요약 (2026-02-03)

🟢 S&P500: +0.45%
📈 VIX: 18.3

TOP 3 종목:
1. AAPL (85.5점)
2. MSFT (83.2점)
3. GOOGL (81.7점)

🔗 전체 보고서
```

---

## 급변 감지 기준

### S&P500 지수
- 🔴 **급락**: -3% 이상 하락
- 🟢 **급등**: +3% 이상 상승

### VIX (변동성)
- ⚠️ **경고**: VIX 25 이상

### 뉴스 감성
- 📰 **감성 급변**: 5개 이상 뉴스 + 매우 긍정/부정

---

## 문제 해결

### 메시지가 안 와요
1. **봇 토큰 확인**
   - config.py에서 `TELEGRAM_BOT_TOKEN` 정확한지 체크
   - 공백 없이 입력했는지 확인

2. **Chat ID 확인**
   - config.py에서 `TELEGRAM_CHAT_ID` 정확한지 체크
   - 숫자만 입력 (따옴표 안에)

3. **봇과 대화 시작했는지 확인**
   - 반드시 봇에게 먼저 메시지 1개 전송 필요
   - START 버튼 클릭

4. **테스트 재실행**
   ```bash
   python telegram_notifier.py
   ```

### 토큰이 유출되었어요
1. @BotFather 접속
2. `/mybots` 명령
3. 해당 봇 선택
4. **API Token** → **Revoke current token**
5. 새 토큰으로 config.py 업데이트

---

## 수동 실행

### 시장 모니터링만
```bash
python market_monitor.py
```

### 전체 업데이트 (리밸런싱 + 알림)
```bash
python daily_update_with_telegram.py
```

---

## 참고 자료

- [텔레그램 봇 API 공식 문서](https://core.telegram.org/bots/api)
- [BotFather 가이드](https://core.telegram.org/bots#6-botfather)
- [GitHub Actions Secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)

---

## 문의

문제가 해결되지 않으면:
1. `telegram_notifier.py` 테스트 실행 결과 확인
2. `market_monitor.py` 단독 실행 테스트
3. GitHub Actions 로그 확인

**설정 완료 후 텔레그램으로 실시간 주식 추천을 받으세요!** 🎉
