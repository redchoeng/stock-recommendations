# 뉴스 감성 분석 통합 가이드

## StockNews vs 현재 시스템 비교

### StockNews (한국 주식)
- **데이터 소스**: 네이버 뉴스
- **수집 방식**: Selenium으로 30초마다 크롤링
- **분석 방법**: ML 모델 (학습 데이터 10,000개)
- **기술**: Python 3.7, Spring Boot, React.js
- **장점**: 실시간 업데이트, 한국 뉴스 최적화

### 현재 시스템 (미국 주식) - 개선 후
- **데이터 소스**: Yahoo Finance, FinancialModelingPrep API
- **수집 방식**: API 호출 (리밸런싱마다 1회)
- **분석 방법**: TextBlob 감성 분석
- **기술**: Python, yfinance
- **장점**: API 안정성, 구현 간단, 비용 무료

---

## 점수 시스템 비교

### 기존 (100점 만점)
```
├─ 기술적 분석: 75점
│  ├─ 모멘텀: 20점
│  ├─ 추세: 20점
│  ├─ 평균회귀: 20점
│  └─ 저변동성: 15점
│
└─ 테마 분석: 25점 (실제로는 0점으로 간소화)
```

### 뉴스 감성 추가 (100점 만점)
```
├─ 기술적 분석: 75점 (동일)
│
├─ 뉴스 감성: 20점 (NEW!)
│  ├─ 뉴스 개수: 5점
│  ├─ 평균 감성: 10점
│  └─ 긍정 비율: 5점
│
└─ 테마 분석: 5점 (간소화)
```

---

## 뉴스 감성 점수 계산 로직

### 1. 뉴스 개수 점수 (5점)
```python
# 최근 7일 뉴스 개수
news_count_score = min(news_count / 10 * 5, 5)

예시:
- 5개 뉴스 → 2.5점
- 10개 이상 → 5점 (만점)
```

### 2. 평균 감성 점수 (10점)
```python
# TextBlob 감성 분석: -1.0 (부정) ~ +1.0 (긍정)
avg_sentiment = sum(sentiments) / len(sentiments)
avg_sentiment_score = (avg_sentiment + 1) / 2 * 10

예시:
- 평균 +0.5 (긍정) → 7.5점
- 평균 0.0 (중립) → 5점
- 평균 -0.3 (부정) → 3.5점
```

### 3. 긍정 뉴스 비율 (5점)
```python
# 감성 > 0.1인 뉴스 비율
positive_ratio = positive_count / total_count
positive_ratio_score = positive_ratio * 5

예시:
- 80% 긍정 → 4점
- 50% 긍정 → 2.5점
```

---

## 구현 방법 3가지

### 방법 1: Yahoo Finance (무료, 제한 있음)
```python
from quant_trading.news_sentiment_analyzer import NewsSentimentAnalyzer

analyzer = NewsSentimentAnalyzer('AAPL')
result = analyzer.calculate_news_score()
# result['total_score']: 0~20점
```

**장점**:
- 완전 무료
- yfinance 기존 사용 중

**단점**:
- API 제한 (하루 2000 calls)
- 뉴스 개수 적음 (10~20개)

---

### 방법 2: FinancialModelingPrep API (추천)
```python
from quant_trading.news_sentiment_analyzer import AdvancedNewsSentimentAnalyzer

analyzer = AdvancedNewsSentimentAnalyzer('AAPL', api_key='YOUR_KEY')
result = analyzer.calculate_news_score()
```

**장점**:
- 무료 250 calls/day
- 더 많은 뉴스 소스 (Bloomberg, CNBC, etc.)
- 뉴스 본문 포함

**단점**:
- API 키 필요 (무료 가입)
- 속도 제한 있음

**API 키 발급**:
1. https://financialmodelingprep.com/register 가입
2. 무료 플랜 선택
3. API 키 받기 (250 calls/day)

---

### 방법 3: 뉴스 API (유료, 무제한)
```python
from newsapi import NewsApiClient

newsapi = NewsApiClient(api_key='YOUR_KEY')
articles = newsapi.get_everything(q='AAPL', language='en')
```

**장점**:
- 제한 없음
- 실시간 뉴스
- 다양한 소스

**단점**:
- 유료 ($449/month for commercial use)

---

## API 제한 대응 전략

### 문제
```
yfinance: Too Many Requests (하루 2000 calls)
→ 50개 종목 × 52주 = 2600 calls 필요
```

### 해결책

#### 1. 캐싱 (추천)
```python
# 같은 날짜는 캐시 사용
news_cache = {}

def get_news_with_cache(ticker, date):
    cache_key = f"{ticker}_{date.strftime('%Y-%m-%d')}"
    if cache_key in news_cache:
        return news_cache[cache_key]

    # API 호출
    result = fetch_news(ticker)
    news_cache[cache_key] = result
    return result
```

#### 2. 딜레이 추가
```python
import time

for ticker in tickers:
    analyze_stock(ticker, date)
    time.sleep(2)  # 2초 대기
```

#### 3. 종목 수 축소
```python
# 상위 30개 종목만
major_tickers = major_tickers[:30]
```

#### 4. 뉴스 분석 간격 늘리기
```python
# 7일마다 → 14일마다
rebalance_days = 14
```

---

## 실전 통합 예시

### backtest_quick.py 수정

```python
# 기존
def analyze_stock(ticker, date):
    tech_v3 = TechnicalAnalyzerV3(df)
    result_v3 = tech_v3.calculate_total_score()
    total_score = result_v3['total_score']  # 75점

    return {'total_score': total_score}

# 뉴스 감성 추가 후
def analyze_stock(ticker, date):
    # 1. 기술적 분석 (75점)
    tech_v3 = TechnicalAnalyzerV3(df)
    result_v3 = tech_v3.calculate_total_score()
    tech_score = result_v3['total_score']

    # 2. 뉴스 감성 (20점)
    try:
        news_analyzer = NewsSentimentAnalyzer(ticker)
        news_result = news_analyzer.calculate_news_score()
        news_score = news_result['total_score']
    except:
        news_score = 0  # 실패 시 0점

    # 3. 총점
    total_score = tech_score + news_score  # 95점 만점

    return {
        'total_score': total_score,
        'tech_score': tech_score,
        'news_score': news_score
    }
```

---

## 예상 성과 개선

### 가설
뉴스 감성이 좋은 종목 = 시장 관심도 높음 = 단기 상승 가능성

### 백테스팅 비교 (예상)

| 전략 | 수익률 | 승률 | MDD | Sharpe |
|-----|-------|------|-----|--------|
| 기존 (기술적 75점) | +22.55% | 59.6% | -21.55% | 2.40 |
| **뉴스 추가 (95점)** | **+26~30%** | **63~67%** | **-18~20%** | **2.6~2.9** |

**근거**:
1. 뉴스 감성은 단기 가격 변동과 상관관계 높음 (학계 연구)
2. 시장 관심도 높은 종목 = 유동성 좋음 = 변동성 낮음
3. 긍정 뉴스 많은 종목 = 기관 매수 가능성

---

## StockNews 접근법의 차이점

### StockNews 방식
```
30초마다 크롤링 → 실시간 감성 분석 → DB 저장 → 웹 표시
```
- **목적**: 실시간 추천
- **리밸런싱**: 수시로 가능
- **서버**: 필요 (24/7 크롤링)

### 현재 시스템 (개선 후)
```
7일마다 분석 → 리밸런싱 → GitHub Actions 자동 실행
```
- **목적**: 주간 리밸런싱
- **리밸런싱**: 7일 주기
- **서버**: 불필요 (GitHub Actions)

---

## 다음 단계

### 1단계: 테스트 (지금 가능)
```bash
python quant_trading/news_sentiment_analyzer.py
```

### 2단계: FinancialModelingPrep API 키 발급 (추천)
1. https://financialmodelingprep.com/register
2. 무료 가입
3. API 키 복사

### 3단계: 백테스팅 실행
```bash
python backtest_with_news.py
```
- 주의: 50개 종목 × 1초 = 50초/주차 소요
- 총 소요 시간: 약 40~50분

### 4단계: 결과 비교
```
기존: backtest_result_*.csv
뉴스: backtest_news_*.csv
```

---

## 비용 비교

| 방법 | 무료 한도 | 비용 (초과 시) | 추천도 |
|-----|----------|--------------|--------|
| Yahoo Finance | ~2000 calls/day | 불가능 | ★★☆ |
| FMP API | 250 calls/day | $14/month | ★★★ (추천) |
| News API | 100 calls/day | $449/month | ★☆☆ |
| 직접 크롤링 | 무제한 | 서버 비용 | ★★☆ |

---

## 결론

**StockNews의 뉴스 감성 분석 방식은 미국 주식에 완전히 적용 가능합니다.**

### 장점
1. ✅ 기존 기술적 분석과 시너지
2. ✅ API 기반 (크롤링보다 안정적)
3. ✅ 무료 옵션 있음 (FMP 250 calls/day)
4. ✅ 구현 간단 (TextBlob)

### 단점
1. ⚠️ API 제한 (해결 방법: 캐싱, 딜레이)
2. ⚠️ 백테스팅 시간 증가 (50종목 × 52주 × 1초 = 40분)

### 추천
**FinancialModelingPrep API 사용 + 캐싱 전략**
- 무료 250 calls/day로 충분
- 더 많은 뉴스 소스
- 본문 포함 분석 가능
